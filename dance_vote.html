<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dance Video Vote ðŸ’œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f172a;--card:#1f2937;--accent:#f472b6;--accent-2:#38bdf8;--text:#e5e7eb;--muted:#9ca3af;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Nunito",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background: radial-gradient(circle at top,#1f2937 0,#020617 55%);
      color:var(--text);
      min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .app{
      width:100%; max-width:1000px;
      background:rgba(15,23,42,.92);
      border:1px solid rgba(148,163,184,.3);
      border-radius:24px;
      padding:24px 24px 30px;
      position:relative;
      overflow:hidden;
      box-shadow:0 18px 45px rgba(0,0,0,.45)
    }
    .blob{position:absolute; width:260px; height:260px; border-radius:999px; filter:blur(40px); opacity:.25; pointer-events:none}
    .blob.pink{background:#f472b6; top:-80px; right:-60px}
    .blob.blue{background:#38bdf8; bottom:-120px; left:-40px}
    .app-inner{position:relative; z-index:1}
    header{display:flex; flex-direction:column; gap:16px; margin-bottom:18px; align-items:flex-start}
    .title{font-size:1.8rem; font-weight:700; display:flex; gap:10px; align-items:center}
    .subtitle{font-size:.95rem; color:var(--muted)}
    .name-form{display:flex; flex-wrap:wrap; gap:12px; align-items:center; border:1px solid rgba(148,163,184,.7);
      padding:10px 12px; border-radius:999px; background:rgba(15,23,42,.85)}
    .name-form input{flex:1 1 150px; background:transparent; border:none; outline:none; color:var(--text); padding:8px 12px}
    .name-form button{border:none; border-radius:999px; padding:8px 14px; cursor:pointer; font-weight:700;
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#0b1120}
    .videos-grid{
      display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin-top:10px;
    }
    .video-card{
      background: radial-gradient(circle at top left, rgba(248,250,252,.06), transparent 65%), var(--card);
      border-radius:16px; padding:12px; border:1px solid rgba(148,163,184,.4);
      box-shadow:0 12px 30px rgba(15,23,42,.8);
      width:300px;
      display:flex; flex-direction:column; gap:8px; align-items:center;
    }
    .song{font-weight:700; font-size:1rem; text-align:center;}
    .tag{font-size:.7rem; padding:2px 8px; border-radius:999px; border:1px solid rgba(148,163,184,.5); color:var(--muted)}
    .video-wrapper{
      border-radius:14px; overflow:hidden;
      border:1px solid rgba(31,41,55,.9);
      background:#000;
      width:100%;
      aspect-ratio:9/16;
    }
    video{
      width:100%; height:100%; object-fit:cover; display:block; background:#000;
    }
    .vote-row{
      display:flex; justify-content:center; align-items:center; gap:8px; font-size:.9rem;
    }
    .cute-check{
      width:20px; height:20px; border-radius:6px; border:2px solid var(--muted);
      display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer; background:rgba(15,23,42,.8);
    }
    .cute-check input{display:none}
    .cute-check span{font-size:.9rem; opacity:0; transform:scale(.5); transition:.08s}
    .cute-check.checked{border-color:var(--accent); box-shadow:0 0 10px rgba(244,114,182,.6); background:rgba(244,114,182,.2)}
    .cute-check.checked span{opacity:1; transform:scale(1)}
    .vote-caption{color:var(--muted); font-size:.8rem}
    .footer{
      display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap;
      gap:12px; margin-top:20px; border-top:1px dashed rgba(148,163,184,.5);
      padding-top:12px; font-size:.85rem; color:var(--muted)
    }
    .status-message{min-height:1.1em}
    .status-message.error{color:#fca5a5}
    .status-message.success{color:#6ee7b7}
  </style>
</head>
<body>
  <div class="app">
    <div class="blob pink"></div><div class="blob blue"></div>
    <div class="app-inner">
      <header>
        <div class="title">Dance Video Voting ðŸ’ƒðŸ’ƒ</div>
        <p class="subtitle">Watch each vertical clip, type your name, and vote for your <b>top two</b> performances!</p>
        <form id="name-form" class="name-form" onsubmit="return false;">
          <label for="name-input" style="color:var(--muted); font-size:.9rem;">Your name</label>
          <input id="name-input" type="text" placeholder="e.g. Zhen..." autocomplete="off" />
          <button id="start-voting-btn" type="button">Start voting ðŸ’«</button>
        </form>
      </header>

      <main>
        <form id="vote-form">
          <div class="videos-grid">
            <!-- SPAGHETTI -->
            <div class="video-card">
              <div class="song">Spaghetti</div>
              <div class="video-wrapper">
                <video controls preload="metadata">
                  <source src="video/spaghetti.mp4" type="video/mp4" />
                </video>
              </div>
              <div class="vote-row">
                <label class="cute-check">
                  <input type="checkbox" name="vote" value="Spaghetti" />
                  <span>âœ“</span>
                </label>
                <span class="vote-caption">Kpop</span>
              </div>
            </div>

            <!-- STRATEGY -->
            <div class="video-card">
              <div class="song">Strategy</div>
              <div class="video-wrapper">
                <video controls preload="metadata">
                  <source src="video/strategy.mp4" type="video/mp4" />
                </video>
              </div>
              <div class="vote-row">
                <label class="cute-check">
                  <input type="checkbox" name="vote" value="Strategy" />
                  <span>âœ“</span>
                </label>
                <span class="vote-caption">Jazz</span>
              </div>
            </div>

            <!-- SPORTS CAR -->
            <div class="video-card">
              <div class="song">Sports Car</div>
              <div class="video-wrapper">
                <video controls preload="metadata">
                  <source src="video/sports_car.mp4" type="video/mp4" />
                </video>
              </div>
              <div class="vote-row">
                <label class="cute-check">
                  <input type="checkbox" name="vote" value="Sports Car" />
                  <span>âœ“</span>
                </label>
                <span class="vote-caption">Jazz</span>
              </div>
            </div>
          </div>

          <div class="footer">
            <span>Tip: vote for <b>exactly two</b> videos âœ¨</span>
            <div style="display:flex; align-items:center; gap:10px;">
              <span id="status" class="status-message"></span>
              <button id="submit-btn" type="submit" class="name-form button" style="padding:8px 16px;">Submit votes</button>
            </div>
          </div>
        </form>
      </main>
    </div>
  </div>

  <script>
    const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbySrA8feUCAfmKFDet3RRsHiY28f4dzgIh1puQgVwNdBEvV9vGNe2ESIQC1GxHma02M/exec"; 
    const nameInput = document.getElementById("name-input");
    const startBtn = document.getElementById("start-voting-btn");
    const form = document.getElementById("vote-form");
    const checks = Array.from(document.querySelectorAll('input[name="vote"]'));
    const statusEl = document.getElementById("status");
    let voter = "";

    const setStatus = (msg, type)=>{
      statusEl.textContent = msg || "";
      statusEl.classList.remove("error","success");
      if(type) statusEl.classList.add(type);
    };

    checks.forEach(cb=>{
      const box = cb.closest(".cute-check");
      cb.addEventListener("change", ()=>{
        const selected = checks.filter(c=>c.checked);
        if(selected.length > 2){
          cb.checked=false;
          setStatus("You can only pick 2 videos ðŸ’¡","error");
        }else setStatus("");
        box.classList.toggle("checked", cb.checked);
      });
    });

    startBtn.addEventListener("click", ()=>{
      const n = nameInput.value.trim();
      if(!n){ setStatus("Please enter your name to start voting ðŸ“","error"); return; }
      voter = n;
      setStatus(`Hi ${n}! Pick your top two favorites ðŸ’•`,"success");
    });

    const submitted = new Set();

    form.addEventListener("submit", e=>{
      e.preventDefault();
      const n = voter || nameInput.value.trim();
      if(!n){ setStatus("Please enter your name first ðŸ¾","error"); return; }
      const selected = checks.filter(c=>c.checked).map(c=>c.value);
      if(selected.length!==2){ setStatus("Select exactly two videos âœŒï¸","error"); return; }
      if(submitted.has(n.toLowerCase())){ setStatus("You've already voted ðŸ’•","error"); return; }

      console.log("Vote:", { name:n, votes:selected, time:new Date().toISOString() });
      setStatus(`Thanks ${n}! You voted for ${selected.join(" + ")} ðŸ’ƒ`,"success");
      submitted.add(n.toLowerCase());
      checks.forEach(c=>{c.checked=false;c.closest(".cute-check").classList.remove("checked");});
    });

    form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        const n = voter || nameInput.value.trim();
        if(!n){ setStatus("Please enter your name first ðŸ¾","error"); return; }
        const chosen = checks.filter(c=>c.checked).map(c=>c.value);
        if(chosen.length !== 2){ setStatus("Select exactly two videos âœŒï¸","error"); return; }

        try {
        const res = await fetch(APP_SCRIPT_URL, {
            method: "POST",
            mode: "no-cors", // Apps Script JSON often works with no-cors publicly
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: n, votes: chosen, userAgent: navigator.userAgent })
        });

        // With no-cors, we canâ€™t read the response reliably; optimistically thank the user:
        setStatus(`Thanks ${n}! Your vote for ${chosen.join(" + ")} is recorded âœ¨`, "success");

        // Optional local guard to reduce duplicates in-session
        submitted.add(n.toLowerCase());
        checks.forEach(c=>{ c.checked=false; c.closest(".cute-check").classList.remove("checked"); });

        } catch (err) {
        setStatus("Sorry, there was a problem saving your vote. Try again.", "error");
        }
    });
  </script>
</body>
</html>
